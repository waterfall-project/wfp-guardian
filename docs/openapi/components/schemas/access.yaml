CheckAccessRequest:
  type: object
  required:
    - service
    - resource_name
    - operation
  properties:
    service:
      type: string
      description: Service identifier
      example: storage
      enum:
        - identity
        - storage
        - project
        - diagram
        - requirement
        - system
        - work
        - budget
        - timesheet
        - analytics
        - basic-io
        - resources
    resource_name:
      type: string
      description: Resource type identifier
      example: files
    operation:
      type: string
      description: Operation to perform
      enum:
        - LIST
        - CREATE
        - READ
        - UPDATE
        - DELETE
        - APPROVE
        - EXPORT
        - IMPORT
      example: READ
    context:
      type: object
      description: |
        Additional context for ABAC/RBAC checks.

        - `project_id`: Project scope
        - `target_company_id`: Target company (hierarchy)
        - `resource_id`: Resource ownership check
      properties:
        project_id:
          type: string
          format: uuid
          description: Project identifier (if applicable)
          example: "550e8400-e29b-41d4-a716-446655440000"
        target_company_id:
          type: string
          format: uuid
          description: Target company identifier (hierarchy check)
          example: "650e8400-e29b-41d4-a716-446655440000"
        resource_id:
          type: string
          format: uuid
          description: Resource identifier (optional)
          example: "750e8400-e29b-41d4-a716-446655440000"

CheckAccessResponse:
  type: object
  required:
    - access_granted
  properties:
    access_granted:
      type: boolean
      description: Whether the access is granted
      example: true
    reason:
      type: string
      description: Explanation if access is denied
      example: "no_matching_role"
      enum:
        - granted
        - no_matching_role
        - no_permission
        - project_mismatch
        - company_mismatch
        - inactive_role
        - expired_role
    message:
      type: string
      description: Detailed message
      example: "Access granted via role 'project_manager' on project 'alpha'"
    access_type:
      type: string
      description: Type of access granted
      example: "direct"
      enum:
        - direct
        - hierarchical
        - company-wide
    matched_role:
      type: object
      description: Role that granted access (if granted)
      properties:
        role_id:
          type: string
          format: uuid
          example: "850e8400-e29b-41d4-a716-446655440000"
        role_name:
          type: string
          example: "project_manager"
        scope_type:
          type: string
          enum: [direct, hierarchical]
          example: "direct"
        project_id:
          type: string
          format: uuid
          nullable: true
          example: "550e8400-e29b-41d4-a716-446655440000"
    cache_hit:
      type: boolean
      description: Whether the result came from cache
      example: true
