CheckAccessRequest:
  type: object
  required:
    - service
    - resource_name
    - operation
  properties:
    service:
      type: string
      description: Service identifier
      example: storage
      enum:
        - identity
        - storage
        - project
        - diagram
        - requirement
        - system
        - work
        - budget
        - timesheet
        - analytics
        - basic-io
        - resources
    resource_name:
      type: string
      description: Resource type identifier
      example: files
    operation:
      type: string
      description: Operation to perform
      enum:
        - LIST
        - CREATE
        - READ
        - UPDATE
        - DELETE
        - APPROVE
        - EXPORT
        - IMPORT
      example: READ
    context:
      type: object
      description: |
        Additional context for ABAC/RBAC checks.

        - `project_id`: Project scope
        - `target_company_id`: Target company (hierarchy)
        - `resource_id`: Resource ownership check
      properties:
        project_id:
          type: string
          format: uuid
          description: Project identifier (if applicable)
          example: "550e8400-e29b-41d4-a716-446655440000"
        target_company_id:
          type: string
          format: uuid
          description: Target company identifier (hierarchy check)
          example: "650e8400-e29b-41d4-a716-446655440000"
        resource_id:
          type: string
          format: uuid
          description: Resource identifier (optional)
          example: "750e8400-e29b-41d4-a716-446655440000"

CheckAccessResponse:
  type: object
  required:
    - access_granted
  properties:
    access_granted:
      type: boolean
      description: Whether the access is granted
      example: true
    reason:
      type: string
      description: Reason for access decision
      example: "no_matching_role"
      enum:
        - granted
        - no_permission
        - no_matching_role
        - role_expired
        - role_inactive
        - project_mismatch
        - company_mismatch
    message:
      type: string
      description: Detailed message
      example: "Access granted via role 'project_manager' on project 'alpha'"
    access_type:
      type: string
      description: Type of access granted
      example: "direct"
      enum:
        - direct
        - hierarchical
        - company-wide
    matched_role:
      type: object
      description: Role that granted access (if granted)
      properties:
        role_id:
          type: string
          format: uuid
          example: "850e8400-e29b-41d4-a716-446655440000"
        role_name:
          type: string
          example: "project_manager"
        scope_type:
          type: string
          enum: [direct, hierarchical]
          example: "direct"
        project_id:
          type: string
          format: uuid
          nullable: true
          example: "550e8400-e29b-41d4-a716-446655440000"
    cache_hit:
      type: boolean
      description: Whether the result came from cache
      example: true

BatchCheckAccessRequest:
  type: object
  required:
    - checks
  properties:
    checks:
      type: array
      minItems: 1
      maxItems: 50
      description: List of checks to perform (max 50)
      items:
        $ref: '#/CheckAccessRequest'

BatchCheckAccessResponse:
  type: object
  required:
    - results
  properties:
    results:
      type: array
      description: Results in the same order as requests
      items:
        $ref: '#/CheckAccessResponse'
    processing_time_ms:
      type: integer
      description: Total processing time (ms)
      example: 15

UserPermissionsResponse:
  type: object
  required:
    - user_id
    - company_id
    - roles
    - permissions
  properties:
    user_id:
      type: string
      format: uuid
      example: "550e8400-e29b-41d4-a716-446655440000"
    company_id:
      type: string
      format: uuid
      example: "650e8400-e29b-41d4-a716-446655440000"
    project_id:
      type: string
      format: uuid
      nullable: true
      description: Project filter (if provided)
      example: "550e8400-e29b-41d4-a716-446655440000"
    roles:
      type: array
      description: User roles
      items:
        type: object
        properties:
          role_id:
            type: string
            format: uuid
          role_name:
            type: string
            example: "project_manager"
          display_name:
            type: string
            example: "Project Manager"
          project_id:
            type: string
            format: uuid
            nullable: true
          scope_type:
            type: string
            enum: [direct, hierarchical]
            example: "direct"
          is_active:
            type: boolean
            example: true
    permissions:
      type: array
      description: All permissions (deduplicated)
      items:
        type: string
        example: "storage:files:DELETE"
    policies:
      type: array
      description: All policies (deduplicated)
      items:
        type: object
        properties:
          policy_id:
            type: string
            format: uuid
          policy_name:
            type: string
            example: "File Management"
          permissions_count:
            type: integer
            example: 5
    processing_time_ms:
      type: integer
      description: Total processing time (ms)
      example: 15
