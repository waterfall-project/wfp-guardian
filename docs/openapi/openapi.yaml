openapi: 3.0.3
info:
  title: Guardian Service API
  version: 0.0.1
  description: |
    **Waterfall Guardian API** - Guardian Service for Waterfall.

    RESTful service for ...

    **Integrations**:
    - Identity: User management
    - Redis: Distributed cache
    - Guardian: RBAC authorization

  contact:
    name: Waterfall Team
    email: contact@waterfall-project.pro
  license:
    name: AGPL-3.0 + Proprietary
    url: https://www.gnu.org/licenses/agpl-3.0.html

servers:
  - url: http://localhost:8000/v0
    description: Local development server
  - url: http://guardian:8000/v0
    description: Docker Compose
  - url: https://guardian.waterfall-project.pro
    description: Production

tags:
  - name: System
    description: Health checks, monitoring, configuration
  - name: Dummies
    description: CRUD operations for dummy entities (example/template)

paths:
  # System endpoints
  /health:
    $ref: './paths/system.yaml#/~1health'
  /ready:
    $ref: './paths/system.yaml#/~1ready'
  /version:
    $ref: './paths/system.yaml#/~1version'
  /configuration:
    $ref: './paths/system.yaml#/~1configuration'
  /metrics:
    $ref: './paths/system.yaml#/~1metrics'

  # Access Control endpoints
  /check-access:
    $ref: './paths/access.yaml#/~1check-access'
  /batch-check-access:
    $ref: './paths/access.yaml#/~1batch-check-access'
  /users/{user_id}/permissions:
    $ref: './paths/access.yaml#/~1users~1{user_id}~1permissions'

  # Role Management endpoints
  /roles:
    $ref: './paths/roles.yaml#/~1roles'
  /roles/{role_id}:
    $ref: './paths/roles.yaml#/~1roles~1{role_id}'
  /roles/{role_id}/policies:
    $ref: './paths/roles.yaml#/~1roles~1{role_id}~1policies'
  /roles/{role_id}/policies/{policy_id}:
    $ref: './paths/roles.yaml#/~1roles~1{role_id}~1policies~1{policy_id}'

  # Policy Management endpoints
  /policies:
    $ref: './paths/policies.yaml#/~1policies'
  /policies/{policy_id}:
    $ref: './paths/policies.yaml#/~1policies~1{policy_id}'
  /policies/{policy_id}/permissions:
    $ref: './paths/policies.yaml#/~1policies~1{policy_id}~1permissions'
  /policies/{policy_id}/permissions/{permission_id}:
    $ref: './paths/policies.yaml#/~1policies~1{policy_id}~1permissions~1{permission_id}'

  # Permission Management endpoints
  /permissions:
    $ref: './paths/permissions.yaml#/~1permissions'
  /permissions/by-service:
    $ref: './paths/permissions.yaml#/~1permissions~1by-service'
  /permissions/{permission_id}:
    $ref: './paths/permissions.yaml#/~1permissions~1{permission_id}'

  # User Role Management endpoints
  /users/{user_id}/roles:
    $ref: './paths/user_roles.yaml#/~1users~1{user_id}~1roles'
  /users/{user_id}/roles/{user_role_id}:
    $ref: './paths/user_roles.yaml#/~1users~1{user_id}~1roles~1{user_role_id}'
  /roles/{role_id}/users:
    $ref: './paths/user_roles.yaml#/~1roles~1{role_id}~1users'

  # Audit endpoints
  /access-logs:
    $ref: './paths/audit.yaml#/~1access-logs'
  /access-logs/{log_id}:
    $ref: './paths/audit.yaml#/~1access-logs~1{log_id}'
  /access-logs/statistics:
    $ref: './paths/audit.yaml#/~1access-logs~1statistics'
  /access-logs/export:
    $ref: './paths/audit.yaml#/~1access-logs~1export'

  # Bootstrap endpoints
  /bootstrap:
    $ref: './paths/bootstrap.yaml#/~1bootstrap'
  /companies/{company_id}/init-roles:
    $ref: './paths/bootstrap.yaml#/~1companies~1{company_id}~1init-roles'

  # Dummy CRUD endpoints
  /dummies:
    $ref: './paths/dummies.yaml#/~1dummies'
  /dummies/{dummyId}:
    $ref: './paths/dummies.yaml#/~1dummies~1{dummyId}'

components:
  securitySchemes:
    JWTAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token passed via HTTP-only cookies containing company_id and user_id

        **JWT Claims**:
        - `user_id` (UUID): Unique user identifier
        - `company_id` (UUID): Company identifier (multi-tenant)
        - `email` (string): User email
        - `exp` (timestamp): Token expiration date
        - `iat` (timestamp): Token issued at date

security:
  - JWTAuth: []
