/bootstrap:
  post:
    operationId: bootstrapSystem
    summary: System RBAC Initialization
    description: |
      **RBAC Initialization Endpoint** called by Identity during bootstrap.

      **Service-to-Service Only** - Requires `X-Internal-Token` header.

      This endpoint:
      1. Validates `X-Internal-Token` against configured secret
      2. Checks if Guardian is already initialized (via Redis/DB flag)
      3. Creates 4 standard Roles for the company:
         - `company_admin`: Full access
         - `project_manager`: Project management
         - `member`: Project participation
         - `viewer`: Read only
      4. Creates 4 standard Policies with appropriate permissions
      5. Creates UserRole to assign `company_admin` to the first user
      6. Marks Guardian as initialized

      **Usage**:
      ```python
      # Called automatically by Identity /bootstrap
      response = requests.post(
          f'{GUARDIAN_URL}/bootstrap',
          json={
              'company_id': 'a1b2c3d4-e5f6-7890-abcd-ef1234567890',
              'user_id': 'f1e2d3c4-b5a6-9807-dcba-fe0987654321'
          },
          headers={'X-Internal-Token': os.environ['INTERNAL_SERVICE_TOKEN']},
          timeout=10.0
      )
      ```
    tags:
      - Bootstrap
    security:
      - InternalToken: []
    parameters:
      - name: X-Internal-Token
        in: header
        required: true
        schema:
          type: string
        description: Internal service-to-service authentication token
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/bootstrap.yaml#/BootstrapRequest'
          examples:
            default:
              $ref: '../examples/bootstrap_responses.json#/bootstrap_request'
    responses:
      '201':
        description: RBAC initialized successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas/bootstrap.yaml#/BootstrapResponse'
            examples:
              default:
                $ref: '../examples/bootstrap_responses.json#/bootstrap_response'
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '422':
        $ref: '../components/responses/UnprocessableEntity.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'

/companies/{company_id}/init-roles:
  post:
    operationId: initCompanyRoles
    summary: Automatic role/policy initialization for new company
    description: |
      **Automatic Endpoint** called by Identity during `POST /companies`.

      **Service-to-service only** - No direct user access.

      This endpoint:
      1. Verifies company exists (via Identity)
      2. Creates 4 standard Roles for this company
      3. Creates 4 standard Policies with appropriate permissions
      4. **Does NOT create UserRole** (no automatic assignment)

      **Difference from /bootstrap**:
      - `/bootstrap`: 1st company + assign user admin
      - `/companies/{id}/init-roles`: New companies + no assignment
    tags:
      - System
    security: []
    parameters:
      - name: company_id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: UUID of the newly created company
        example: "b2c3d4e5-f6a7-8901-bcde-f23456789012"
    responses:
      '200':
        description: Roles/Policies created successfully
        content:
          application/json:
            schema:
              $ref: '../components/schemas/bootstrap.yaml#/InitRolesResponse'
            examples:
              default:
                $ref: '../examples/bootstrap_responses.json#/init_roles_response'
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '409':
        $ref: '../components/responses/Conflict.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'
