/health:
  get:
    tags:
      - System
    summary: Liveness probe
    description: |
      Checks that the service is alive (process is running).

      **Usage**: Kubernetes liveness probe
    operationId: healthCheck
    security: []
    responses:
      '200':
        description: Service is alive
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  example: ok
                timestamp:
                  type: string
                  format: date-time
                  example: 2025-12-22T10:30:00Z
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '429':
        $ref: '../components/responses/TooManyRequests.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'
/ready:
  get:
    tags:
      - System
    summary: Readiness probe
    description: |
      Checks that the service is ready to handle requests.

      **Checks**:
      - PostgreSQL connection
      - Redis connection (if enabled)
      - Identity Service accessible (if enabled)

      **Usage**: Kubernetes readiness probe
    operationId: readinessCheck
    security: []
    responses:
      '200':
        description: Service is ready
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  example: ready
                checks:
                  type: object
                  properties:
                    database:
                      type: string
                      example: ok
                    redis:
                      type: string
                      example: ok
                    identity:
                      type: string
                      example: ok
                timestamp:
                  type: string
                  format: date-time
                  example: 2025-12-22T10:30:00Z
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '429':
        $ref: '../components/responses/TooManyRequests.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'
      '503':
        description: Service is not ready
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  example: not_ready
                checks:
                  type: object
                  properties:
                    database:
                      type: string
                      example: error
                    redis:
                      type: string
                      example: ok
                timestamp:
                  type: string
                  format: date-time
                  example: 2025-12-22T10:30:00Z

/version:
  get:
    tags:
      - System
    summary: Service version
    description: Returns the current version of the service
    operationId: getVersion
    security:
      - JWTAuth: []
    responses:
      '200':
        description: Service version information
        content:
          application/json:
            schema:
              type: object
              properties:
                service:
                  type: string
                  example: guardian-service
                version:
                  type: string
                  example: 0.0.1
                build_date:
                  type: string
                  example: 2025-12-22T10:30:00Z
                commit:
                  type: string
                  example: abc123d
                python_version:
                  type: string
                  example: 3.11.0
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '403':
        $ref: '../components/responses/Forbidden.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'

/configuration:
  get:
    tags:
      - System
    summary: Active configuration
    description: |
      Returns the active service configuration (without secrets).

      **Security**: Never returns JWT_SECRET_KEY, DATABASE_PASSWORD, etc.
      **Required permission**: Authenticated access (admin recommended)
    operationId: getConfiguration
    security:
      - JWTAuth: []
    responses:
      '200':
        description: Active configuration
        content:
          application/json:
            schema:
              type: object
              properties:
                jwt_algorithm:
                  type: string
                  example: HS256
                jwt_access_token_expire_minutes:
                  type: integer
                  example: 30
                jwt_refresh_token_expire_days:
                  type: integer
                  example: 7
                enable_rate_limit:
                  type: boolean
                  example: true
                rate_limit_requests:
                  type: integer
                  example: 100
                rate_limit_window:
                  type: integer
                  example: 60
                use_redis_service:
                  type: boolean
                  example: true
                use_identity_service:
                  type: boolean
                  example: true
                log_level:
                  type: string
                  example: INFO
                log_format:
                  type: string
                  example: json
                enable_access_logging:
                  type: boolean
                  example: true
                  description: Enable audit event logging
                access_log_retention_days:
                  type: integer
                  example: 365
                  description: Audit log retention period (days)
                access_log_level:
                  type: string
                  example: info
                  enum: [info, warning, critical]
                  description: Audit event filtering level
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '401':
        $ref: '../components/responses/Unauthorized.yaml'
      '403':
        $ref: '../components/responses/Forbidden.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'

/metrics:
  get:
    tags:
      - System
    summary: Prometheus metrics
    description: |
      Exposes metrics in Prometheus format.

      **Standard Flask metrics** (via prometheus_flask_exporter):
      - `flask_http_request_duration_seconds` : Request duration histogram
      - `flask_http_request_total` : Total HTTP requests counter
      - `flask_http_request_exceptions_total` : Total exceptions counter
      - `flask_exporter_info` : Application info (version)

      **Note**: Security is not enforced on this endpoint by default
    operationId: getMetrics
    security: []
    responses:
      '200':
        description: Prometheus metrics
        content:
          text/plain:
            schema:
              type: string
              example: |
                # HELP flask_http_request_duration_seconds Flask HTTP request duration in seconds
                # TYPE flask_http_request_duration_seconds histogram
                flask_http_request_duration_seconds_bucket{le="0.005",method="GET",path="/v0/health",status="200"} 0.0
                flask_http_request_duration_seconds_bucket{le="0.01",method="GET",path="/v0/health",status="200"} 1.0
                flask_http_request_duration_seconds_bucket{le="0.025",method="GET",path="/v0/health",status="200"} 1.0
                flask_http_request_duration_seconds_bucket{le="+Inf",method="GET",path="/v0/health",status="200"} 1.0
                flask_http_request_duration_seconds_count{method="GET",path="/v0/health",status="200"} 1.0
                flask_http_request_duration_seconds_sum{method="GET",path="/v0/health",status="200"} 0.008775966000030166

                # HELP flask_http_request_total Total number of HTTP requests
                # TYPE flask_http_request_total counter
                flask_http_request_total{method="GET",status="200"} 1.0

                # HELP flask_http_request_exceptions_total Total number of HTTP requests which resulted in an exception
                # TYPE flask_http_request_exceptions_total counter

                # HELP python_info Python platform information
                # TYPE python_info gauge
                python_info{implementation="CPython",major="3",minor="13",patchlevel="5",version="3.13.5"} 1.0

                # HELP flask_exporter_info Information about the Prometheus Flask exporter
                # TYPE flask_exporter_info gauge
                flask_exporter_info{version="0.23.2"} 1.0
      '400':
        $ref: '../components/responses/BadRequest.yaml'
      '429':
        $ref: '../components/responses/TooManyRequests.yaml'
      '500':
        $ref: '../components/responses/ServerError.yaml'
